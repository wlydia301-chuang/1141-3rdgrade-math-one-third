<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ†æ•¸æ¯”å¤§å°å¯¦é©—å®¤</title>
    <style>
        :root {
            --bg-color: #f0f8ff;
            --panel-color: #ffffff;
            --primary-color: #4a90e2;
            --text-color: #333;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            user-select: none; /* é˜²æ­¢æ‹–æ›³æ™‚é¸å–æ–‡å­— */
        }

        h1 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.8rem;
        }

        /* æ§åˆ¶é¢æ¿ */
        .controls {
            background: var(--panel-color);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            align-items: center;
            margin-bottom: 30px;
            max-width: 800px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 1px solid #eee;
            padding: 10px;
            border-radius: 10px;
        }

        .control-group label {
            font-size: 0.9rem;
            margin-bottom: 5px;
            font-weight: bold;
        }

        select, input[type="number"] {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ccc;
            font-size: 1rem;
            text-align: center;
        }

        input[type="color"] {
            border: none;
            width: 40px;
            height: 40px;
            cursor: pointer;
            background: none;
        }

        /* ç•«å¸ƒå€åŸŸ */
        #canvas-area {
            display: flex;
            justify-content: space-around;
            width: 100%;
            max-width: 900px;
            height: 500px; /* è¶³å¤ çš„ç©ºé–“é€²è¡Œæ‹–æ›³ */
            position: relative;
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            border: 2px dashed #ddd;
        }

        .fraction-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding-top: 50px;
            position: relative;
        }

        .fraction-label {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #555;
            pointer-events: none; /* è®“æ»‘é¼ å¯ä»¥ç©¿éæ–‡å­— */
        }

        /* SVG æ¨£å¼ */
        svg {
            overflow: visible; /* å…è¨±åœ–å½¢è¢«æ‹–å‡º SVG é‚Šç•Œ */
            cursor: grab;
        }

        svg:active {
            cursor: grabbing;
        }

        .draggable-part {
            transition: opacity 0.2s;
            filter: drop-shadow(0px 2px 3px rgba(0,0,0,0.2));
        }

        .draggable-part:hover {
            opacity: 0.9;
            stroke: #333;
            stroke-width: 2px;
        }

        .dragging {
            opacity: 0.7; /* æ‹–æ›³æ™‚è®Šé€æ˜ï¼Œæ–¹ä¾¿æ¯”è¼ƒ */
            z-index: 1000;
        }

        /* èƒŒæ™¯çš„ç©ºæ¡†ç·š */
        .outline {
            fill: none;
            stroke: #ccc;
            stroke-width: 2px;
            pointer-events: none; /* åªæœ‰æœ‰é¡è‰²çš„éƒ¨åˆ†å¯ä»¥æ‹–æ›³ */
        }

        /* æç¤ºè¨Šæ¯ */
        .instruction {
            margin-top: 10px;
            color: #666;
            font-size: 0.9rem;
            background: #eef;
            padding: 5px 15px;
            border-radius: 20px;
        }

    </style>
</head>
<body>

    <h1>ä¸‰å¹´ç´šåˆ†æ•¸æ¯”è¼ƒå¯¦é©—å®¤</h1>
    
    <div class="controls">
        <div class="control-group">
            <label>åœ–å½¢å½¢ç‹€</label>
            <select id="shapeType" onchange="renderAll()">
                <option value="circle">åœ“å½¢ (æŠ«è–©)</option>
                <option value="bar">é•·æ¢å½¢ (å·§å…‹åŠ›)</option>
            </select>
        </div>

        <div class="control-group">
            <label style="color: #e74c3c;">å·¦é‚Šåˆ†æ•¸ (A)</label>
            <div style="display:flex; gap:5px; align-items:center;">
                <input type="number" id="num1" value="1" min="0" max="12" style="width:50px" onchange="renderAll()">
                <span>/</span>
                <input type="number" id="den1" value="3" min="1" max="12" style="width:50px" onchange="renderAll()">
                <input type="color" id="color1" value="#e74c3c" onchange="renderAll()">
            </div>
        </div>

        <div class="control-group">
            <label style="color: #3498db;">å³é‚Šåˆ†æ•¸ (B)</label>
            <div style="display:flex; gap:5px; align-items:center;">
                <input type="number" id="num2" value="1" min="0" max="12" style="width:50px" onchange="renderAll()">
                <span>/</span>
                <input type="number" id="den2" value="4" min="1" max="12" style="width:50px" onchange="renderAll()">
                <input type="color" id="color2" value="#3498db" onchange="renderAll()">
            </div>
        </div>
        
        <div class="control-group">
             <label>é‡ç½®ä½ç½®</label>
             <button onclick="renderAll()" style="padding:8px 15px; cursor:pointer; background:#666; color:white; border:none; border-radius:5px;">æ­¸ä½</button>
        </div>
    </div>

    <div class="instruction">ğŸ’¡ è©¦è©¦çœ‹ï¼šç”¨æ»‘é¼ æŒ‰ä½æœ‰é¡è‰²çš„ç©æœ¨ï¼ŒæŠŠå®ƒæ‹–æ›³åˆ°å¦ä¸€é‚Šç–Šç–Šçœ‹ï¼Œèª°æ¯”è¼ƒå¤§ï¼Ÿ</div>

    <div id="canvas-area">
        <div class="fraction-container">
            <div class="fraction-label" id="label1">1/3</div>
            <div id="container1"></div>
        </div>
        
        <div class="fraction-container">
            <div class="fraction-label" id="label2">1/4</div>
            <div id="container2"></div>
        </div>
    </div>

    <script>
        const SIZE = 200; // åœ–å½¢åŸºç¤å¤§å°
        let currentDrag = null;
        let offset = { x: 0, y: 0 };

        function renderAll() {
            const shape = document.getElementById('shapeType').value;
            
            // è®€å–å·¦é‚Šæ•¸æ“š
            const n1 = parseInt(document.getElementById('num1').value);
            const d1 = parseInt(document.getElementById('den1').value);
            const c1 = document.getElementById('color1').value;
            
            // è®€å–å³é‚Šæ•¸æ“š
            const n2 = parseInt(document.getElementById('num2').value);
            const d2 = parseInt(document.getElementById('den2').value);
            const c2 = document.getElementById('color2').value;

            // æ›´æ–°æ–‡å­—æ¨™ç±¤
            document.getElementById('label1').textContent = `${n1} / ${d1}`;
            document.getElementById('label2').textContent = `${n2} / ${d2}`;

            // ç¹ªè£½åœ–å½¢
            drawFraction('container1', shape, n1, d1, c1, 'drag1');
            drawFraction('container2', shape, n2, d2, c2, 'drag2');
        }

        function drawFraction(containerId, shape, num, den, color, dragId) {
            const container = document.getElementById(containerId);
            container.innerHTML = ''; // æ¸…ç©º

            const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.setAttribute("width", SIZE);
            svg.setAttribute("height", SIZE);
            svg.setAttribute("viewBox", `0 0 ${SIZE} ${SIZE}`);
            
            // 1. ç¹ªè£½åº•æ¡† (ä»£è¡¨ "1")
            const outlineGroup = document.createElementNS("http://www.w3.org/2000/svg", "g");
            outlineGroup.setAttribute("class", "outline");
            
            // 2. ç¹ªè£½æœ‰é¡è‰²çš„éƒ¨åˆ† (ä»£è¡¨åˆ†æ•¸ï¼Œå¯æ‹–æ›³)
            const filledGroup = document.createElementNS("http://www.w3.org/2000/svg", "g");
            filledGroup.setAttribute("class", "draggable-part");
            filledGroup.setAttribute("id", dragId);
            filledGroup.setAttribute("fill", color);

            // åŠ å…¥æ‹–æ›³äº‹ä»¶
            addDragLogic(filledGroup);

            if (shape === 'circle') {
                const cx = SIZE / 2;
                const cy = SIZE / 2;
                const r = (SIZE / 2) - 5;

                // ç•«åº•åœ“
                const bgCircle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                bgCircle.setAttribute("cx", cx);
                bgCircle.setAttribute("cy", cy);
                bgCircle.setAttribute("r", r);
                outlineGroup.appendChild(bgCircle);
                
                // ç•«åˆ†å‰²ç·š (åº•åœ–)
                for(let i=0; i<den; i++) {
                    const angle = (i * 360 / den) - 90; // -90 è®“èµ·å§‹é»åœ¨12é»é˜æ–¹å‘
                    const rad = angle * Math.PI / 180;
                    const x2 = cx + r * Math.cos(rad);
                    const y2 = cy + r * Math.sin(rad);
                    const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                    line.setAttribute("x1", cx);
                    line.setAttribute("y1", cy);
                    line.setAttribute("x2", x2);
                    line.setAttribute("y2", y2);
                    line.setAttribute("stroke", "#ccc");
                    outlineGroup.appendChild(line);
                }

                // ç•«æ‰‡å½¢ (å¯¦å¿ƒéƒ¨åˆ†) - ç‚ºäº†æ–¹ä¾¿æ¯”è¼ƒï¼Œæˆ‘å€‘æŠŠæ‰€æœ‰ä»½æ•¸åˆä½µæˆä¸€å€‹å¤§æ‰‡å½¢
                // å¦‚æœéœ€è¦åˆ†é–‹ä¸€å¡Šä¸€å¡Šï¼Œé‚è¼¯æœƒä¸åŒï¼Œä½†æ¯”å¤§å°é€šå¸¸æ˜¯æ¯”è¼ƒã€Œç¸½é‡ã€
                if (num > 0) {
                     // å¦‚æœæ˜¯å¤§æ–¼ç­‰æ–¼1 (æ»¿åœ“)
                    if (num >= den) {
                        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                        circle.setAttribute("cx", cx);
                        circle.setAttribute("cy", cy);
                        circle.setAttribute("r", r);
                        filledGroup.appendChild(circle);
                    } else {
                        // ç•«æ‰‡å½¢è·¯å¾‘
                        const startAngle = -90;
                        const endAngle = (num * 360 / den) - 90;
                        const pathData = describeArc(cx, cy, r, startAngle, endAngle);
                        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                        path.setAttribute("d", pathData);
                        filledGroup.appendChild(path);
                    }
                }

            } else {
                // é•·æ¢å½¢ Bar
                const w = SIZE - 10;
                const h = SIZE / 2; // é•·æ¢ä¸éœ€è¦é‚£éº¼é«˜
                const x = 5;
                const y = (SIZE - h) / 2;

                // ç•«åº•æ¡†
                const bgRect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                bgRect.setAttribute("x", x);
                bgRect.setAttribute("y", y);
                bgRect.setAttribute("width", w);
                bgRect.setAttribute("height", h);
                outlineGroup.appendChild(bgRect);

                // ç•«åˆ†å‰²ç·š
                const step = w / den;
                for(let i=1; i<den; i++) {
                    const lx = x + (i * step);
                    const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                    line.setAttribute("x1", lx);
                    line.setAttribute("y1", y);
                    line.setAttribute("x2", lx);
                    line.setAttribute("y2", y + h);
                    line.setAttribute("stroke", "#ccc");
                    outlineGroup.appendChild(line);
                }

                // ç•«å¯¦å¿ƒéƒ¨åˆ†
                if (num > 0) {
                    const fillW = Math.min(w, w * (num / den)); // é¿å…è¶…éæ¡†ç·š
                    const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                    rect.setAttribute("x", x);
                    rect.setAttribute("y", y);
                    rect.setAttribute("width", fillW);
                    rect.setAttribute("height", h);
                    filledGroup.appendChild(rect);
                }
            }

            svg.appendChild(outlineGroup);
            svg.appendChild(filledGroup);
            container.appendChild(svg);
        }

        // SVG åœ“å¼§è¨ˆç®—å‡½æ•¸
        function polarToCartesian(centerX, centerY, radius, angleInDegrees) {
            var angleInRadians = (angleInDegrees - 90) * Math.PI / 180.0;
            // ä¿®æ­£åº§æ¨™ç³»ï¼Œè®“å…¶å¾ä¸Šæ–¹é–‹å§‹é †æ™‚é‡
            angleInRadians = angleInDegrees * Math.PI / 180.0; 

            return {
                x: centerX + (radius * Math.cos(angleInRadians)),
                y: centerY + (radius * Math.sin(angleInRadians))
            };
        }

        function describeArc(x, y, radius, startAngle, endAngle) {
            var start = polarToCartesian(x, y, radius, endAngle);
            var end = polarToCartesian(x, y, radius, startAngle);
            var largeArcFlag = endAngle - startAngle <= 180 ? "0" : "1";

            var d = [
                "M", x, y,
                "L", start.x, start.y,
                "A", radius, radius, 0, largeArcFlag, 0, end.x, end.y,
                "Z"
            ].join(" ");

            return d;
        }

        // æ‹–æ›³é‚è¼¯
        function addDragLogic(element) {
            let startX, startY, initialTransformX = 0, initialTransformY = 0;

            element.addEventListener('mousedown', startDrag);
            element.addEventListener('touchstart', startDrag, {passive: false});

            function startDrag(e) {
                e.preventDefault();
                currentDrag = element;
                
                // è®€å–ç•¶å‰çš„ transform (å¦‚æœæœ‰)
                const transform = currentDrag.getAttribute('transform');
                if (transform) {
                    const match = /translate\(([^,]+),([^)]+)\)/.exec(transform);
                    if (match) {
                        initialTransformX = parseFloat(match[1]);
                        initialTransformY = parseFloat(match[2]);
                    }
                } else {
                    initialTransformX = 0;
                    initialTransformY = 0;
                }

                const clientX = e.clientX || e.touches[0].clientX;
                const clientY = e.clientY || e.touches[0].clientY;

                startX = clientX;
                startY = clientY;
                
                element.classList.add('dragging');

                document.addEventListener('mousemove', drag);
                document.addEventListener('touchmove', drag, {passive: false});
                document.addEventListener('mouseup', endDrag);
                document.addEventListener('touchend', endDrag);
            }

            function drag(e) {
                if (!currentDrag) return;
                e.preventDefault();

                const clientX = e.clientX || e.touches[0].clientX;
                const clientY = e.clientY || e.touches[0].clientY;

                const dx = clientX - startX;
                const dy = clientY - startY;

                // æ›´æ–°ä½ç½®
                const newX = initialTransformX + dx;
                const newY = initialTransformY + dy;
                
                currentDrag.setAttribute('transform', `translate(${newX}, ${newY})`);
            }

            function endDrag() {
                if (currentDrag) {
                    currentDrag.classList.remove('dragging');
                    currentDrag = null;
                }
                document.removeEventListener('mousemove', drag);
                document.removeEventListener('touchmove', drag);
                document.removeEventListener('mouseup', endDrag);
                document.removeEventListener('touchend', endDrag);
            }
        }

        // åˆå§‹åŒ–
        window.onload = renderAll;

    </script>
</body>
</html>
